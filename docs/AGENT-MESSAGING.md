# Agentæ¶ˆæ¯é€šä¿¡ APIæ–‡æ¡£

## æ¦‚è¿°

æ¶ˆæ¯ç³»ç»Ÿæ”¯æŒAgenté—´çš„ç‚¹å¯¹ç‚¹é€šä¿¡ï¼Œé€šè¿‡Hookæ³¨å…¥æ¶ˆæ¯åˆ°ä¸Šä¸‹æ–‡ã€‚

## æ¶ˆæ¯ç±»å‹

| ç±»å‹ | ç”¨é€” |
|------|------|
| task | ä»»åŠ¡åˆ†é… |
| progress | è¿›åº¦æ›´æ–° |
| result | ç»“æœä¸ŠæŠ¥ |
| error | é”™è¯¯é€šçŸ¥ |
| control | æ§åˆ¶æŒ‡ä»¤ |

## Daemon Socket API

### send_message

å‘é€æ¶ˆæ¯

```json
{
  "action": "send_message",
  "from": "agent-001",
  "to": "agent-002",
  "type": "task",
  "content": "æ¶ˆæ¯å†…å®¹",
  "metadata": {},
  "reply_to": "msg_id (å¯é€‰)"
}
```

### get_messages

è·å–Agentçš„æ¶ˆæ¯

```json
{
  "action": "get_messages",
  "session_id": "agent-002",
  "unread_only": false
}
```

### mark_messages_read

æ ‡è®°æ¶ˆæ¯ä¸ºå·²è¯»

```json
{
  "action": "mark_messages_read",
  "session_id": "agent-002",
  "message_ids": ["msg_id1", "msg_id2"]
}
```

### query_messages

æŸ¥è¯¢æ¶ˆæ¯

```json
{
  "action": "query_messages",
  "type": "task",
  "status": "pending",
  "limit": 10,
  "since": 1234567890
}
```

### task_completion

æŠ¥å‘Šä»»åŠ¡å®Œæˆ

```json
{
  "action": "task_completion",
  "session_id": "agent-002",
  "report": {
    "task_id": "task-001",
    "status": "success",
    "result": "ç»“æœå†…å®¹",
    "error": "é”™è¯¯ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰",
    "duration": 5000
  }
}
```

## Hookä½¿ç”¨

### AgentMessaging.hook.ts

è‡ªåŠ¨åœ¨å·¥å…·è°ƒç”¨åæ£€æŸ¥å¹¶æ³¨å…¥æ¶ˆæ¯ã€‚

éœ€è¦åœ¨Agenté…ç½®ä¸­å¯ç”¨ï¼š

```json
{
  "hooks": {
    "tool_call_end": ["AgentMessaging.hook.ts"]
  }
}
```

### TaskCompletion.hook.ts

æŠ¥å‘Šä»»åŠ¡å®Œæˆã€‚

ç”¨æ³•ï¼š

```bash
# ç›´æ¥è°ƒç”¨
./TaskCompletion.hook.ts task-001 --status success --result "å®Œæˆ"

# ä»æ–‡ä»¶è¯»å–
./TaskCompletion.hook.ts --file report.json
```

## æ¶ˆæ¯æ ¼å¼

æ¶ˆæ¯é€šè¿‡Hookæ³¨å…¥åˆ°Agentä¸Šä¸‹æ–‡ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ğŸ”” æ‚¨æœ‰æ–°çš„Agentæ¶ˆæ¯                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ ğŸ“¬ æ–°æ¶ˆæ¯æ¥è‡ª: agent-001
â”‚ ç±»å‹: task
â”‚ æ—¶é—´: 2026-01-31 12:00:00
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ è¯·åˆ†æè¿™ä¸ªé¡¹ç›®çš„æ¶æ„...
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

## ä»»åŠ¡ç»“æœå­˜å‚¨

ä»»åŠ¡å®ŒæˆæŠ¥å‘Šå­˜å‚¨åœ¨ï¼š

```
~/.claude/AGENT_TASKS/
â””â”€â”€ {task-id}/
    â”œâ”€â”€ meta.json
    â””â”€â”€ {session-id}.md
```
